<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mood ‚Üí Workout Recommender ‚Äî Nadim Sheikh</title>
  <meta name="description" content="Mood ‚Üí Workout Recommender ‚Äî static demo with left-side safety box."/>
  <style>
    :root{
      --bg-1:#041022; --bg-2:#07162a; --muted:#9bb0c3;
      --accent-1:#67e6ff; --accent-2:#3ad6c9;
      --mood-color:#67e6ff; --stress-color:#ff9f6b; --sleep-color:#9be67a;
      --card-radius:12px; --shadow: 0 14px 36px rgba(2,10,20,0.6);
      --glass: rgba(255,255,255,0.02);
      font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
    }

    /* page */
    html,body{height:100%;margin:0;overflow:hidden;background:
      radial-gradient(900px 400px at 8% 8%, rgba(12,40,70,0.12), transparent 8%),
      linear-gradient(180deg,var(--bg-1), var(--bg-2)); color:#eaf8ff;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}

    .app {
      height:100vh; width:100%; display:flex; align-items:center; justify-content:center;
      padding:20px; box-sizing:border-box;
    }

    /* center panel */
    .panel {
      width:100%; max-width:920px; height: calc(100vh - 40px);
      display:grid; grid-template-rows: auto 1fr auto; gap:10px;
      align-items:start; position:relative; /* allow absolute children placed relative to this */
    }

    header { padding:6px 10px; }
    h1{margin:0;font-size:20px}
    p.lead{margin:6px 0 0 0;color:var(--muted);font-size:12px}

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: var(--card-radius); padding:14px; box-shadow:var(--shadow); border:1px solid rgba(255,255,255,0.03);
      display:flex; flex-direction:column; gap:10px; overflow:auto;
      scroll-behavior:smooth;
    }

    .inputs { display:grid; grid-template-columns: 1fr 1fr; gap:12px; align-items:start; }
    label{display:block;color:var(--muted);font-size:12px;margin-bottom:6px}
    .slider-wrap{background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); padding:8px;border-radius:8px}
    input[type="range"]{width:100%; accent-color: var(--accent-1); height:28px}

    .controls { display:flex; gap:8px; align-items:center; justify-content:flex-start; flex-wrap:wrap; }
    .btn {
      background: linear-gradient(180deg,var(--accent-1), #39d7e3); color:#042026; border:0; padding:8px 12px; border-radius:8px; font-weight:800; cursor:pointer;
      box-shadow: 0 8px 20px rgba(15,113,131,0.08);
      font-size:13px;
    }
    .btn.secondary { background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03); font-weight:700; padding:7px 10px; }

    .result {
      border-radius:10px; padding:12px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-left:4px solid rgba(103,230,255,0.06);
      transition: all .28s ease; font-size:13px;
    }
    .result h3 { margin:0 0 6px 0; font-size:14px; display:flex; align-items:center; gap:8px; }
    .result p { margin:0;color:#eaf8ff; white-space:pre-wrap; font-size:13px; line-height:1.25 }
    .result ul { margin:6px 0 0 18px; color:var(--muted); font-size:13px; }

    .meta { margin-top:8px; color:var(--muted); font-size:12px }

    .history { display:flex; gap:12px; align-items:center; justify-content:space-between; margin-top:6px; }
    .chart { width:340px; height:96px; border-radius:8px; display:flex; align-items:center; justify-content:center; background:transparent; }
    .chart-legend { display:flex; gap:8px; align-items:center; color:var(--muted); font-size:12px; }

    .consent { display:none; margin-top:8px; padding:10px; border-radius:8px; background:rgba(255,255,255,0.01); border:1px solid rgba(255,255,255,0.02); font-size:13px; }
    .consent.show { display:block; }

    /* ******** SAFETY BOX (left of card) ******** */
    .safety-box {
      position: absolute;
      /* place to the left of the card, aligned with card top */
      left: -220px;   /* negative moves it left outside the card area; tweak if needed */
      top: 10px;
      width: 200px;
      min-height: 200px;
      border-radius: 10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.03);
      padding: 12px;
      box-shadow: 0 14px 36px rgba(2,10,20,0.5);
      display: none; /* shown only when safety triggers */
      box-sizing: border-box;
    }
    .safety-box.show { display:block; }

    .safety-box .icon {
      width:100%; height:100px; display:flex; align-items:center; justify-content:center; margin-bottom:8px;
    }
    .safety-box .icon img { max-width:100%; max-height:100%; border-radius:6px; object-fit:cover; opacity:0.95; }

    .safety-box .text {
      font-size:12px; color:#ffece8; font-weight:700; margin-bottom:8px;
      background: linear-gradient(90deg,#2f2330,#1b2a30); padding:8px;border-radius:8px;
    }
    .safety-box .sub { color:var(--muted); font-weight:600; font-size:12px; margin-top:6px; }

    /* responsive: hide safety box on narrow screens and move to top area instead */
    @media (max-width:980px) {
      .safety-box { display:none !important; } /* small screens: hide left box to avoid layout issues */
    }

    footer{color:var(--muted); font-size:12px; padding:6px 10px; text-align:left}

  </style>
</head>
<body>
  <div class="app">
    <div class="panel" role="application" aria-labelledby="appTitle">
      <!-- header -->
      <header>
        <h1 id="appTitle">Mood ‚Üí Workout Recommender</h1>
        <p class="lead">Psychology-informed quick recommendations using simple, explainable rules. Static demo ‚Äî no backend.</p>
      </header>

      <!-- Safety box (placed left of card) -->
      <div id="safetyBox" class="safety-box" aria-hidden="true" role="status" aria-live="polite">
        <div class="icon">
          <!-- local image path provided in your environment -->
          <img src="/mnt/data/272c6218-0bf1-459e-b959-5fcee45b090a.png" alt="safety image" />
        </div>
        <div class="text" id="safetyTitle">‚ö†Ô∏è Safety first</div>
        <div class="sub" id="safetyText">You reported extremely low sleep, very high stress, or very low mood. Prioritize rest and safety ‚Äî avoid intense exercise now. If at risk, contact emergency services.</div>
      </div>

      <!-- main card -->
      <section class="card" aria-label="Main controls and results">
        <!-- inputs -->
        <div class="inputs">
          <div>
            <label for="mood">Mood (0 sad ‚Äî 10 happy): <strong id="moodVal">0</strong></label>
            <div class="slider-wrap"><input id="mood" type="range" min="0" max="10" value="0" aria-label="Mood slider"></div>
          </div>
          <div>
            <label for="stress">Stress (0 low ‚Äî 10 high): <strong id="stressVal">0</strong></label>
            <div class="slider-wrap"><input id="stress" type="range" min="0" max="10" value="0" aria-label="Stress slider"></div>
          </div>

          <div style="grid-column:1 / -1;">
            <label for="sleep">Sleep last night (hours / 10): <strong id="sleepVal">0</strong></label>
            <div class="slider-wrap"><input id="sleep" type="range" min="0" max="10" value="0" aria-label="Sleep slider"></div>
          </div>

          <div style="grid-column:1 / -1; display:flex; justify-content:flex-start; gap:8px; margin-top:6px">
            <button id="go" class="btn">Get Recommendation</button>
            <button id="sample" class="btn secondary">Try sample</button>
            <button id="reset" class="btn secondary">Reset</button>
          </div>
        </div>

        <!-- result -->
        <div id="result" class="result" style="display:none"></div>

        <!-- consent -->
        <div id="consentBox" class="consent" role="group" aria-label="consent area">
          <label style="display:flex;align-items:center;gap:8px">
            <input id="consentCheck" type="checkbox" />
            <span style="color:var(--muted);font-size:12px">I understand this is a safety-first recovery plan. I give consent to see optional gentle movement suggestions (only if I feel safe).</span>
          </label>
          <div style="margin-top:8px; display:flex; gap:8px;">
            <button id="consentProceed" class="btn" disabled>Show suggestions</button>
            <button id="consentSkip" class="btn secondary">Skip suggestions</button>
          </div>
        </div>

        <!-- history & chart -->
        <div class="history" aria-label="history and chart">
          <div>
            <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Recent submissions (last 5)</div>
            <div style="display:flex;gap:8px;align-items:center">
              <button id="clearHistory" class="btn secondary" style="font-size:12px;padding:6px 8px">Clear history</button>
            </div>
          </div>
          <div class="chart" id="chartContainer" aria-hidden="false">
            <div style="color:var(--muted);font-size:12px">No history yet ‚Äî submit to record.</div>
          </div>
        </div>

        <!-- built by below the card content -->
        <div style="color:var(--muted); font-size:12px; padding-top:6px">
          Built by <strong>Nadim Sheikh</strong>
        </div>
      </section>

      <!-- footer removed from bottom to keep 'Built by' next to card -->
    </div>
  </div>

  <script>
    // Suggestions (kept small for brevity)
    const SUGGESTIONS = {
      immediate_recovery: {
        title: "üõå Immediate Recovery ‚Äî Rest First",
        description: "Priority: safety and rest. Breathe, hydrate, eat a small snack, rest. Avoid intense exercise until you have restorative sleep.",
        steps: [
          "Sit/lie down in a safe, comfortable place.",
          "3‚Äì6 min diaphragmatic breathing (4s inhale ‚Äî 6s exhale).",
          "Drink ~200‚Äì300 ml water slowly.",
          "If possible, eat a light snack (banana, yoghurt, toast).",
          "Ask a trusted person for a 20‚Äì30 min check-in."
        ],
        intensity: "Very low"
      },
      grounding_stress: {
        title: "üßò Grounding + Gentle Movement",
        description: "3‚Äì5 min grounding breathing then 5‚Äì7 min light walk or standing mobility.",
        steps: ["3‚Äì5 min breathing","5‚Äì7 min gentle walk","2 min progressive relaxation"],
        intensity: "Very low"
      },
      mood_activation: {
        title: "üèÉ Short Cardio Burst (Mood Booster)",
        description: "20 minutes moderate cardio. If energy low, target 10‚Äì12 min.",
        steps: ["5 min warm-up","12‚Äì20 min moderate cardio","3‚Äì5 min cool down + breathing"],
        intensity: "Moderate"
      },
      balanced: {
        title: "‚öñÔ∏è Balanced Session",
        description: "30-minute: warm-up, focused work, cool-down.",
        steps: ["8 min warm-up","15 min focused work","7 min cool-down + breathing"],
        intensity: "Moderate"
      }
    };

    // DOM refs
    const mood = document.getElementById('mood');
    const stress = document.getElementById('stress');
    const sleep = document.getElementById('sleep');
    const moodVal = document.getElementById('moodVal');
    const stressVal = document.getElementById('stressVal');
    const sleepVal = document.getElementById('sleepVal');
    const go = document.getElementById('go');
    const sample = document.getElementById('sample');
    const reset = document.getElementById('reset');
    const result = document.getElementById('result');
    const safetyBox = document.getElementById('safetyBox');
    const safetyTitle = document.getElementById('safetyTitle');
    const safetyText = document.getElementById('safetyText');
    const consentBox = document.getElementById('consentBox');
    const consentCheck = document.getElementById('consentCheck');
    const consentProceed = document.getElementById('consentProceed');
    const consentSkip = document.getElementById('consentSkip');
    const chartContainer = document.getElementById('chartContainer');
    const clearHistory = document.getElementById('clearHistory');

    function updateLabels(){
      moodVal.textContent = mood.value;
      stressVal.textContent = stress.value;
      sleepVal.textContent = sleep.value;
    }
    [mood, stress, sleep].forEach(el => el.addEventListener('input', updateLabels));
    updateLabels();

    // Local history (last 5)
    const STORAGE_KEY = 'mwr_history_v1';
    function loadHistory(){ try{ const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : []; }catch(e){return[]} }
    function saveHistory(arr){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr.slice(-5))); }catch(e){} }
    function pushRecord(rec){ const arr = loadHistory(); arr.push(rec); const slice = arr.slice(-5); saveHistory(slice); return slice; }
    function clearHistoryFn(){ localStorage.removeItem(STORAGE_KEY); renderChart([]); }
    clearHistory.addEventListener('click', clearHistoryFn);

    // Decision logic
    function decideRecommendation(m,s,sl){
      if (sl <= 1 && s >= 9 && m <= 2) return { primary:'immediate_recovery', secondary:null, highRisk:true };
      if (sl <= 2) return { primary:'immediate_recovery', secondary:(s>=8?'grounding_stress':null), highRisk:false };
      if (s >= 9 && m <= 3) return { primary:'grounding_stress', secondary:'mood_activation', highRisk:false };
      if (s >= 8) return { primary:'grounding_stress', secondary:(m<=4?'mood_activation':null), highRisk:false };
      if (m <= 4) return { primary:'mood_activation', secondary:(sl<=4?'immediate_recovery':null), highRisk:false };
      if (sl <= 4) return { primary:'immediate_recovery', secondary:null, highRisk:false };
      if (m >= 7 && s <= 4) return { primary:'balanced', secondary:null, highRisk:false };
      return { primary:'balanced', secondary:null, highRisk:false };
    }

    // Render recommendation and show/hide safety box
    function renderRecommendation(decision, reported){
      const primary = SUGGESTIONS[decision.primary];
      const secondary = decision.secondary ? SUGGESTIONS[decision.secondary] : null;

      // If immediate recovery: show safety box at left
      if (decision.primary === 'immediate_recovery') {
        safetyBox.classList.add('show');
        safetyBox.setAttribute('aria-hidden','false');
        // you can adjust title/text if needed
        safetyTitle.textContent = '‚ö†Ô∏è Safety first';
        safetyText.textContent = 'You reported extremely low sleep, very high stress, or very low mood. Prioritize rest and safety ‚Äî avoid intense exercise now. If at risk, contact emergency services.';

        // show primary summary
        result.style.display = 'block';
        result.innerHTML = `
          <h3>${primary.title}</h3>
          <p>${primary.description}</p>
          <ul>${primary.steps.map(s => `<li>${s}</li>`).join('')}</ul>
          <div class="meta">You reported mood ${reported.m}, stress ${reported.s}, sleep ${reported.sl}. Intensity: ${primary.intensity || 'Very low'}.</div>
        `;
        consentBox.classList.add('show');
        consentCheck.checked = false;
        consentProceed.disabled = true;
        return;
      }

      // otherwise hide safety box and render normal result
      safetyBox.classList.remove('show');
      safetyBox.setAttribute('aria-hidden','true');
      consentBox.classList.remove('show');

      result.style.display = 'block';
      result.innerHTML = `
        <h3>${primary.title}</h3>
        <p>${primary.description}</p>
        <ul>${primary.steps.map(s => `<li>${s}</li>`).join('')}</ul>
        <div class="meta">You reported mood ${reported.m}, stress ${reported.s}, sleep ${reported.sl}. Suggested intensity: ${primary.intensity || 'Moderate'}.</div>
      `;
    }

    // Render chart (compact)
    function renderChart(history){
      chartContainer.innerHTML = '';
      if (!history || !history.length) {
        chartContainer.innerHTML = '<div style="color:var(--muted);font-size:12px">No history yet ‚Äî submit to record.</div>';
        return;
      }
      const w = chartContainer.clientWidth || 340;
      const h = chartContainer.clientHeight || 96;
      const pad = {l:28, r:8, t:8, b:18};
      const innerW = Math.max(60, w - pad.l - pad.r);
      const innerH = Math.max(40, h - pad.t - pad.b);
      const n = history.length;
      const xStep = innerW / Math.max(1, n - 1);
      const x = i => pad.l + i * xStep;
      const y = v => pad.t + innerH - (v/10)*innerH;

      const path = (key) => history.map((d,i) => `${i===0?'M':'L'} ${x(i).toFixed(2)} ${y(d[key]).toFixed(2)}`).join(' ');
      const pMood = path('m'), pStress = path('s'), pSleep = path('sl');

      const svg = `
        <svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="history">
          <path d="${pStress}" fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--stress-color')}" stroke-width="1.8" stroke-dasharray="5 4"/>
          <path d="${pSleep}" fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--sleep-color')}" stroke-width="1.8" stroke-dasharray="2 3"/>
          <path d="${pMood}" fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--mood-color')}" stroke-width="2.4" />
        </svg>
      `;
      chartContainer.innerHTML = svg;
    }

    // helpers
    function createRecord(m,s,sl){ return { m:Number(m), s:Number(s), sl:Number(sl), t:Date.now() }; }

    go.addEventListener('click', () => {
      const m = Number(mood.value), s = Number(stress.value), sl = Number(sleep.value);
      const decision = decideRecommendation(m,s,sl);
      renderRecommendation(decision, {m,s,sl});
      const newHist = pushRecord(createRecord(m,s,sl));
      renderChart(newHist);
    });

    sample.addEventListener('click', () => {
      const sampleSet = [{m:0,s:10,sl:0},{m:2,s:8,sl:3},{m:5,s:4,sl:7},{m:8,s:3,sl:8},{m:6,s:5,sl:6}];
      const pick = sampleSet[Math.floor(Math.random()*sampleSet.length)];
      mood.value = pick.m; stress.value = pick.s; sleep.value = pick.sl; updateLabels();
      const decision = decideRecommendation(pick.m,pick.s,pick.sl);
      renderRecommendation(decision,{m:pick.m,s:pick.s,sl:pick.sl});
      const newHist = pushRecord(createRecord(pick.m,pick.s,pick.sl)); renderChart(newHist);
    });

    reset.addEventListener('click', () => {
      mood.value = 0; stress.value = 0; sleep.value = 0; updateLabels();
      result.style.display = 'none'; result.innerHTML = '';
      safetyBox.classList.remove('show'); consentBox.classList.remove('show');
    });

    consentCheck.addEventListener('change', () => { consentProceed.disabled = !consentCheck.checked; });
    consentProceed.addEventListener('click', () => {
      const decision = decideRecommendation(Number(mood.value),Number(stress.value),Number(sleep.value));
      if (decision.primary === 'immediate_recovery') {
        const optional = SUGGESTIONS.grounding_stress;
        if (!optional) return;
        const extra = `<div style="margin-top:8px"><strong>${optional.title} (optional)</strong><ul>${optional.steps.map(s=>`<li>${s}</li>`).join('')}</ul></div>`;
        result.insertAdjacentHTML('beforeend', extra);
        consentBox.classList.remove('show');
      }
    });
    consentSkip.addEventListener('click', ()=>{ consentBox.classList.remove('show'); });

    clearHistory.addEventListener('click', () => { localStorage.removeItem(STORAGE_KEY); renderChart([]); });

    // init
    (function init(){
      const hist = (function(){ try{ const r = localStorage.getItem(STORAGE_KEY); return r?JSON.parse(r):[];}catch(e){return [];} })();
      renderChart(hist);
      mood.value = 0; stress.value = 0; sleep.value = 0; updateLabels();
      result.style.display = 'none'; safetyBox.classList.remove('show'); consentBox.classList.remove('show');
    })();

    // responsive redraw
    window.addEventListener('resize', () => {
      const hist = (function(){ try{ const r = localStorage.getItem(STORAGE_KEY); return r?JSON.parse(r):[];}catch(e){return [];} })();
      renderChart(hist);
    });

    // local storage helper definitions used earlier
    function loadHistory(){ try{ const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : []; }catch(e){return[]} }
    function saveHistory(arr){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr.slice(-5))); }catch(e){} }
    function pushRecord(rec){ const arr = loadHistory(); arr.push(rec); const slice = arr.slice(-5); saveHistory(slice); return slice; }

    // keyboard accessibility
    [mood, stress, sleep].forEach(s => s.addEventListener('keydown', e => { if (e.key === 'Enter') go.click(); }));
  </script>
</body>
</html>
