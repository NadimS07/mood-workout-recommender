<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mood ‚Üí Workout Recommender ‚Äî Nadim Sheikh</title>
  <meta name="description" content="A compact, psychology-informed Mood to Workout recommender with local history chart. Static demo ‚Äî no backend.">
  <style>
    :root{
      --bg-1:#041022; --bg-2:#07162a; --muted:#9bb0c3;
      --accent-1:#67e6ff; --accent-2:#3ad6c9; --glass: rgba(255,255,255,0.03);
      --mood-color:#67e6ff; --stress-color:#ff9f6b; --sleep-color:#9be67a;
      --success:#e8fbff; --radius:14px; --shadow-lg: 0 18px 40px rgba(2,10,20,0.6);
      --shadow-sm: 0 6px 18px rgba(2,6,12,0.45);
      font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
    }

    html,body{height:100%;margin:0;background:
      radial-gradient(900px 400px at 12% 10%, rgba(12,40,70,0.12), transparent 8%),
      linear-gradient(180deg,var(--bg-1), var(--bg-2));
      color:#eaf8ff; display:flex; align-items:center; justify-content:center; padding:48px; }

    .wrap{width:100%;max-width:880px;margin:0 auto;display:flex;flex-direction:column;gap:18px}
    header{display:block;margin-bottom:6px}
    h1{margin:0;font-size:20px}
    p.lead{margin:8px 0 0 0;color:var(--muted);font-size:13px}

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius:var(--radius); padding:18px; box-shadow:var(--shadow-lg); border:1px solid rgba(255,255,255,0.03);
      backdrop-filter: blur(8px);
    }

    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:200px}
    label{display:block;color:var(--muted);font-size:13px;margin-bottom:8px}
    .slider-wrap{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); padding:10px;border-radius:10px}
    input[type="range"]{width:100%; accent-color: var(--accent-1)}

    .controls{display:flex; gap:10px; align-items:center}
    .btn{
      background:linear-gradient(180deg,var(--accent-1), #39d7e3); border:none; color:#042026; padding:10px 14px; border-radius:10px; font-weight:800;
      cursor:pointer; box-shadow:var(--shadow-sm);
    }
    .btn.secondary{ background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03); font-weight:700 }
    .btn:focus{ outline:2px solid rgba(103,230,255,0.12) }

    .glow{position:relative;margin-top:-28px;height:120px;pointer-events:none}
    .glow:before{
      content:""; position:absolute; left:50%; transform:translateX(-50%); width:84%; height:140px; border-radius:28px;
      background: radial-gradient(450px 120px at 50% 10%, rgba(103,230,255,0.06), transparent 30%);
      filter: blur(22px); z-index:0;
    }

    .result{ margin-top:14px; padding:14px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-left:4px solid rgba(103,230,255,0.06); opacity:0; transform:translateY(12px); transition: all .36s cubic-bezier(.2,.9,.25,1);
    }
    .result.show{opacity:1; transform:translateY(0)}
    .result h3{margin:0 0 8px 0;font-size:16px}
    .result p{margin:0;color:var(--success);white-space:pre-wrap;font-size:14px}
    .result .sub{display:block;margin-top:10px;color:var(--muted);font-size:13px}
    .meta-list{margin-top:10px;color:var(--muted);font-size:13px}

    /* Safety banner */
    .safety-banner{
      display:none; margin-bottom:10px; padding:12px; border-radius:10px; background:linear-gradient(90deg,#2f2330,#1b2a30);
      border:1px solid rgba(255,255,255,0.03); color:#ffece8; font-weight:700;
    }
    .safety-banner.show{display:block}

    .consent { display:none; margin-top:10px; padding:12px; border-radius:10px; background:rgba(255,255,255,0.01); border:1px solid rgba(255,255,255,0.02); }
    .consent.show{display:block}

    /* Chart area */
    .history {
      margin-top:14px; padding:12px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border:1px solid rgba(255,255,255,0.02);
    }
    .chart-row { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap }
    .chart-legend { display:flex; gap:10px; align-items:center; color:var(--muted); font-size:13px }
    .legend-dot { width:10px;height:10px;border-radius:999px; display:inline-block; margin-right:6px }
    .no-history { color:var(--muted); font-size:13px; padding:12px 0 }

    footer{display:flex;align-items:center;gap:12px;color:var(--muted);font-size:13px;padding-top:6px}

    @media (max-width:920px){ .wrap{padding:0 12px} }
    @media (max-width:640px){ body{padding:24px} .glow{display:none} }
  </style>
</head>
<body>
  <main class="wrap" role="main" aria-labelledby="appTitle">
    <!-- Hidden local asset reference (transformable by your environment) -->
    <img id="asset-ref" src="/mnt/data/cd4549cb-8aae-422b-99de-0f1c9f32aa24.png" alt="" style="display:none" />

    <header>
      <h1 id="appTitle">Mood ‚Üí Workout Recommender</h1>
      <p class="lead">Psychology-informed quick recommendations using simple, explainable rules. Static demo ‚Äî no backend.</p>
    </header>

    <div id="safetyBanner" class="safety-banner" role="alert" aria-live="assertive">
      ‚ö†Ô∏è <strong>Safety first:</strong> You reported extremely low sleep, very high stress, and very low mood. The immediate priority is safety and rest ‚Äî do not start intense exercise right now. If you are in danger or thinking about harming yourself, contact emergency services immediately.
    </div>

    <section class="card" aria-labelledby="inputsHeading">
      <h2 id="inputsHeading" style="position:absolute;left:-9999px;">Inputs</h2>

      <div class="row">
        <div class="col">
          <label for="mood">Mood (0 sad ‚Äî 10 happy): <strong id="moodVal">0</strong></label>
          <div class="slider-wrap"><input id="mood" type="range" min="0" max="10" value="0" aria-label="Mood slider"></div>
        </div>

        <div class="col">
          <label for="stress">Stress (0 low ‚Äî 10 high): <strong id="stressVal">0</strong></label>
          <div class="slider-wrap"><input id="stress" type="range" min="0" max="10" value="0" aria-label="Stress slider"></div>
        </div>
      </div>

      <div class="row" style="align-items:center;margin-top:10px">
        <div style="flex:1;min-width:220px">
          <label for="sleep">Sleep last night (hours / 10): <strong id="sleepVal">0</strong></label>
          <div class="slider-wrap"><input id="sleep" type="range" min="0" max="10" value="0" aria-label="Sleep slider"></div>
        </div>

        <div style="display:flex;gap:10px;align-items:center">
          <button id="go" class="btn" aria-controls="result">Get Recommendation</button>
          <button id="sample" class="btn secondary" title="Try sample scenarios">Try sample</button>
          <button id="reset" class="btn secondary" title="Reset sliders">Reset</button>
        </div>
      </div>

      <div class="glow" aria-hidden="true"></div>

      <section id="result" class="result" role="status" aria-live="polite" aria-hidden="true"></section>

      <!-- Consent area -->
      <div id="consentBox" class="consent" role="group" aria-label="Consent for low-arousal movement suggestions">
        <label style="display:flex;align-items:center;gap:8px">
          <input id="consentCheck" type="checkbox" />
          <span style="color:var(--muted)">I understand this is a safety-first recovery plan. I give consent to see optional gentle movement suggestions (only if I feel safe).</span>
        </label>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="consentProceed" class="btn" disabled>Show suggestions</button>
          <button id="consentSkip" class="btn secondary">Skip suggestions</button>
        </div>
      </div>

      <div style="margin-top:12px;color:var(--muted);font-size:13px">Psychology note: suggestions prioritize safety, affect regulation, and recovery. If you feel at risk, contact emergency services or a trusted person.</div>

      <!-- History & Chart -->
      <div class="history" aria-label="Recent submissions history">
        <div class="chart-row" style="margin-bottom:8px">
          <div style="display:flex;align-items:center;gap:12px">
            <strong style="color:var(--muted)">Recent submissions (last 5)</strong>
            <button id="clearHistory" class="btn secondary" title="Clear local history">Clear history</button>
          </div>
          <div class="chart-legend">
            <span><span class="legend-dot" style="background:var(--mood-color)"></span> Mood</span>
            <span><span class="legend-dot" style="background:var(--stress-color)"></span> Stress</span>
            <span><span class="legend-dot" style="background:var(--sleep-color)"></span> Sleep</span>
          </div>
        </div>

        <div id="chartContainer" style="width:100%;height:160px;border-radius:8px;overflow:hidden;background:transparent;display:flex;align-items:center;justify-content:center">
          <div class="no-history">No history yet ‚Äî submit a recommendation to create local history.</div>
        </div>
      </div>
    </section>

    <footer>
      <div>Built by <strong>Nadim Sheikh</strong></div>
    </footer>
  </main>

  <script>
    // ---------- DATA & SUGGESTIONS (as before) ----------
    const SUGGESTIONS = {
      immediate_recovery: {
        title: "üõå Immediate Recovery & Safety Plan ‚Äî Rest First",
        short: "Prioritize safety, rest, and very low-arousal recovery. No intense exercise.",
        description: "You reported almost no sleep, very high stress, and very low mood. Stabilize first: breathe, hydrate, eat a light snack, rest. Avoid intense exercise until you've had restorative sleep.",
        quick: "0‚Äì15 min: breathing (3‚Äì6 min) + water + light snack + rest; 15‚Äì90 min: short nap or guided relaxation.",
        steps: [
          "Sit or lie down in a safe, comfortable place.",
          "3‚Äì6 minutes diaphragmatic breathing (4s inhale ‚Äî 6s exhale).",
          "Drink ~200‚Äì300 ml water slowly.",
          "If possible, eat a light snack (banana, yoghurt, or toast).",
          "Ask a trusted person for a 20‚Äì30 min check-in."
        ],
        why: [
          "Severe sleep loss amplifies stress response and increases injury risk.",
          "Breathing, hydration, and short rest reduce physiological arousal and support safety."
        ],
        intensity: "Very low"
      },
      grounding_stress: {
        title: "üßò Grounding + Short Low-Intensity Movement",
        short: "Grounding breathing followed by gentle movement to reduce acute stress.",
        description: "Start with 3‚Äì5 minutes of grounding breathing, then a gentle routine (mobility/walk). This reduces physiological arousal and gives immediate affect regulation.",
        quick: "10-min: 3 min breathing + 7 min gentle walk or mobility.",
        steps: [
          "3‚Äì5 min box/belly breathing (4-4-4-4 or 4-6 diaphragmatic breaths).",
          "5‚Äì7 min standing marches or light walk.",
          "2 min progressive muscle relaxation (tension/release)."
        ],
        why: [
          "Breathing reduces sympathetic activation.",
          "Short movement releases tension without raising arousal too much."
        ],
        intensity: "Very low ‚Äî Low"
      },
      mood_activation: {
        title: "üèÉ Short Cardio Burst (Mood Booster)",
        short: "Moderate cardio to raise mood and energy.",
        description: "20 minutes of moderate cardio (brisk walk or cycling). If energy is very low, aim for 10‚Äì12 minutes.",
        quick: "10-min: 5 min warm-up + 7‚Äì8 min steady cardio.",
        steps: [
          "5 min warm-up (dynamic moves).",
          "12‚Äì20 min moderate cardio.",
          "3‚Äì5 min cool down + breathing."
        ],
        why: [
          "Rhythmic cardio has mood-lifting effects.",
          "Short sessions reduce activation barriers and build momentum."
        ],
        intensity: "Moderate"
      },
      strength_boost: {
        title: "üí™ Strength Session ‚Äî Full Body",
        short: "Resistance training for competence and self-efficacy.",
        description: "30‚Äì40 minutes of resistance training focusing on compound moves. Good on days with higher mood and low stress.",
        quick: "10-min: 2‚Äì3 rounds bodyweight circuit (squats, push-ups, plank).",
        steps: [
          "3‚Äì5 min warm-up.",
          "3‚Äì5 sets compound moves (squat, row/pull, hinge).",
          "5‚Äì8 min mobility + breathing."
        ],
        why: [
          "Strength training improves perceived control and long-term mood.",
          "Structured progress supports self-efficacy."
        ],
        intensity: "Moderate ‚Äî High"
      },
      balanced: {
        title: "‚öñÔ∏è Balanced Session",
        short: "A safe mixed session when no single factor dominates.",
        description: "30-minute balanced routine: warm-up, focused work, cool-down. Useful as a daily default and for tracking responses.",
        quick: "10-min: 3 min warm-up, 5 min focused work, 2 min cool-down.",
        steps: [
          "8 min warm-up (mobility + light cardio).",
          "15 min focused work (cardio or strength).",
          "7 min cool-down + breathing."
        ],
        why: [
          "Balanced sessions allow experimentation with what helps mood most.",
          "Tracking helps identify patterns across days."
        ],
        intensity: "Moderate"
      }
    };

    // ---------- DOM BINDINGS ----------
    const mood = document.getElementById('mood');
    const stress = document.getElementById('stress');
    const sleep = document.getElementById('sleep');
    const moodVal = document.getElementById('moodVal');
    const stressVal = document.getElementById('stressVal');
    const sleepVal = document.getElementById('sleepVal');
    const go = document.getElementById('go');
    const sample = document.getElementById('sample');
    const reset = document.getElementById('reset');
    const result = document.getElementById('result');
    const safetyBanner = document.getElementById('safetyBanner');
    const consentBox = document.getElementById('consentBox');
    const consentCheck = document.getElementById('consentCheck');
    const consentProceed = document.getElementById('consentProceed');
    const consentSkip = document.getElementById('consentSkip');
    const chartContainer = document.getElementById('chartContainer');
    const clearHistory = document.getElementById('clearHistory');

    function updateLabels(){
      moodVal.textContent = mood.value;
      stressVal.textContent = stress.value;
      sleepVal.textContent = sleep.value;
    }
    [mood, stress, sleep].forEach(el => el.addEventListener('input', updateLabels));
    updateLabels();

    // ---------- LOCAL HISTORY STORAGE ----------
    const STORAGE_KEY = 'mwr_history_v1'; // Mood Workout Recommender history

    function loadHistory() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        return JSON.parse(raw);
      } catch (e) {
        console.error('Failed reading history', e);
        return [];
      }
    }

    function saveHistory(arr) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(arr.slice(-5)));
      } catch (e) {
        console.error('Failed saving history', e);
      }
    }

    function pushRecord(record) {
      const arr = loadHistory();
      arr.push(record);
      // keep last 5
      const slice = arr.slice(-5);
      saveHistory(slice);
      return slice;
    }

    function clearHistoryFn() {
      localStorage.removeItem(STORAGE_KEY);
      renderChart([]);
    }

    clearHistory.addEventListener('click', () => {
      clearHistoryFn();
    });

    // ---------- DECISION LOGIC (keeps safety-first) ----------
    function decideRecommendation(m, s, sl) {
      if (sl <= 1 && s >= 9 && m <= 2) return { primary: 'immediate_recovery', secondary: null, highRisk: true };
      if (sl <= 2) return { primary: 'immediate_recovery', secondary: (s >= 8 ? 'grounding_stress' : null), highRisk: false };
      if (s >= 9 && m <= 3) return { primary: 'grounding_stress', secondary: 'mood_activation', highRisk: false };
      if (s >= 8) return { primary: 'grounding_stress', secondary: (m <= 4 ? 'mood_activation' : null), highRisk: false };
      if (m <= 4) return { primary: 'mood_activation', secondary: (sl <= 4 ? 'immediate_recovery' : null), highRisk: false };
      if (sl <= 4) return { primary: 'immediate_recovery', secondary: null, highRisk: false };
      if (m >= 7 && s <= 4) return { primary: 'strength_boost', secondary: null, highRisk: false };
      return { primary: 'balanced', secondary: null, highRisk: false };
    }

    // ---------- RENDER & CHART ----------
    function renderRecommendation(decision, reported) {
      const primary = SUGGESTIONS[decision.primary];
      const secondary = decision.secondary ? SUGGESTIONS[decision.secondary] : null;

      if (decision.primary === 'immediate_recovery') {
        safetyBanner.classList.add('show');
        consentBox.classList.remove('show');
        result.classList.remove('show');
        setTimeout(() => {
          result.innerHTML = `
            <h3>${primary.title}</h3>
            <p>${primary.description}</p>
            <div style="margin-top:8px;color:var(--muted);font-size:13px">
              <strong>Immediate steps (0‚Äì15 min):</strong>
              <ul style="margin:6px 0 0 18px;color:var(--success);font-size:14px">
                ${primary.steps.map(s => `<li>${s}</li>`).join('')}
              </ul>
            </div>
            <div class="meta-list">
              <strong>Why this?</strong>
              <ul style="margin:6px 0 0 18px;color:var(--muted);font-size:13px">
                ${primary.why.map(w => `<li>${w}</li>`).join('')}
              </ul>
            </div>
            <div class="sub" style="margin-top:10px">You reported mood ${reported.m}, stress ${reported.s}, sleep ${reported.sl}. Intensity: Very low.</div>
          `;
          result.classList.add('show');
        }, 80);

        consentBox.classList.add('show');
        consentCheck.checked = false;
        consentProceed.disabled = true;
        return;
      }

      safetyBanner.classList.remove('show');
      consentBox.classList.remove('show');

      const whyBullets = primary.why.concat(secondary ? [`Also suggested: ${secondary.title} ‚Äî ${secondary.short}`] : []);
      const intensity = primary.intensity || 'Moderate';
      let stepsHtml = '';
      if (primary.steps && primary.steps.length) {
        stepsHtml = '<ul style="margin:8px 0 0 18px;color:var(--success)">';
        primary.steps.forEach(s => stepsHtml += `<li>${s}</li>`);
        stepsHtml += '</ul>';
      }
      const quick = primary.quick ? `<div style="margin-top:10px"><strong>If 10 minutes:</strong> ${primary.quick}</div>` : '';
      const secondaryHtml = secondary ? `
        <div style="margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)">
          <strong style="display:block;margin-bottom:6px;color:var(--muted)">${secondary.title}</strong>
          <div style="color:var(--muted);font-size:13px">${secondary.short}</div>
        </div>
      ` : '';

      result.classList.remove('show');
      setTimeout(() => {
        result.innerHTML = `
          <h3>${primary.title}</h3>
          <p>${primary.description}</p>
          ${stepsHtml}
          ${quick}
          ${secondaryHtml}
          <div class="meta-list">
            <strong>Why this?</strong>
            <ul style="margin:6px 0 0 18px;color:var(--muted);font-size:13px">
              ${whyBullets.map(b => `<li>${b}</li>`).join('')}
            </ul>
          </div>
          <div class="sub" style="margin-top:10px">You reported mood ${reported.m}, stress ${reported.s}, sleep ${reported.sl}. Suggested intensity: ${intensity}.</div>
        `;
        result.classList.add('show');
      }, 80);
    }

    // Render chart: simple SVG with 3 lines (mood, stress, sleep). History is array of objects {m,s,sl,t}
    function renderChart(history) {
      chartContainer.innerHTML = '';
      if (!history || !history.length) {
        chartContainer.innerHTML = '<div class="no-history">No history yet ‚Äî submit a recommendation to create local history.</div>';
        return;
      }

      // prepare svg
      const w = chartContainer.clientWidth || 760;
      const h = 140;
      const padding = { l: 36, r: 12, t: 8, b: 22 };
      const innerW = Math.max(100, w - padding.l - padding.r);
      const innerH = Math.max(60, h - padding.t - padding.b);

      // x positions equally spaced
      const n = history.length;
      const xStep = innerW / Math.max(1, n - 1);
      function x(i) { return padding.l + i * xStep; }
      // y scale 0-10 maps to bottom-top
      function y(val) { return padding.t + innerH - (val / 10) * innerH; }

      // build path for each metric
      function buildPath(key) {
        return history.map((d, i) => `${i === 0 ? 'M' : 'L'} ${x(i).toFixed(2)} ${y(d[key]).toFixed(2)}`).join(' ');
      }

      const moodPath = buildPath('m');
      const stressPath = buildPath('s');
      const sleepPath = buildPath('sl');

      // ticks on y-axis: 0, 5, 10
      const yTicks = [10,5,0];

      // labels for x: time short (HH:MM) or relative
      const labels = history.map(d => {
        const dt = new Date(d.t);
        const hh = dt.getHours().toString().padStart(2,'0');
        const mm = dt.getMinutes().toString().padStart(2,'0');
        return `${hh}:${mm}`;
      });

      // svg
      const svg = `
        <svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="History chart">
          <defs>
            <linearGradient id="gMood" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0" stop-color="${getComputedStyle(document.documentElement).getPropertyValue('--mood-color')}" stop-opacity="0.9"/>
              <stop offset="1" stop-color="${getComputedStyle(document.documentElement).getPropertyValue('--mood-color')}" stop-opacity="0.2"/>
            </linearGradient>
          </defs>

          <!-- y grid and labels -->
          ${yTicks.map(t => `<line x1="${padding.l}" x2="${w - padding.r}" y1="${y(t)}" y2="${y(t)}" stroke="rgba(255,255,255,0.02)" stroke-width="1"/>`).join('')}
          ${yTicks.map(t => `<text x="${8}" y="${y(t)+4}" fill="${getComputedStyle(document.documentElement).getPropertyValue('--muted')}" font-size="11">${t}</text>`).join('')}

          <!-- stress path (dashed) -->
          <path d="${stressPath}" fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--stress-color')}" stroke-width="2" stroke-opacity="0.95" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="6 4" />

          <!-- sleep path (dotted) -->
          <path d="${sleepPath}" fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--sleep-color')}" stroke-width="2" stroke-opacity="0.95" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="2 4" />

          <!-- mood path (solid) -->
          <path d="${moodPath}" fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--mood-color')}" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round" />

          <!-- points -->
          ${history.map((d,i) => `<circle cx="${x(i)}" cy="${y(d.m)}" r="3.6" fill="${getComputedStyle(document.documentElement).getPropertyValue('--mood-color')}" />`).join('')}
          ${history.map((d,i) => `<rect x="${x(i)-3}" y="${y(d.s)-3}" width="6" height="6" rx="1.6" fill="${getComputedStyle(document.documentElement).getPropertyValue('--stress-color')}" />`).join('')}
          ${history.map((d,i) => `<circle cx="${x(i)}" cy="${y(d.sl)}" r="2.6" fill="${getComputedStyle(document.documentElement).getPropertyValue('--sleep-color')}" />`).join('')}

          <!-- x labels -->
          ${labels.map((lab,i) => `<text x="${x(i)}" y="${h - 4}" fill="${getComputedStyle(document.documentElement).getPropertyValue('--muted')}" font-size="11" text-anchor="middle">${lab}</text>`).join('')}
        </svg>
      `;

      chartContainer.innerHTML = svg;
    }

    // ---------- RECORD FLOW ----------
    function createRecord(m, s, sl) {
      return { m: Number(m), s: Number(s), sl: Number(sl), t: Date.now() };
    }

    // When user clicks Get Recommendation: decide, render, push to history, render chart
    go.addEventListener('click', () => {
      const m = Number(mood.value);
      const s = Number(stress.value);
      const sl = Number(sleep.value);
      const decision = decideRecommendation(m, s, sl);
      renderRecommendation(decision, { m, s, sl });

      // push to local history
      const newHistory = pushRecord(createRecord(m, s, sl));
      renderChart(newHistory);
    });

    // sample scenarios (also push to history so you can demo chart)
    sample.addEventListener('click', () => {
      const scenarios = [
        {m:0, s:10, sl:0},
        {m:2, s:8, sl:3},
        {m:5, s:4, sl:7},
        {m:8, s:3, sl:8},
        {m:6, s:5, sl:6}
      ];
      const sidx = scenarios[Math.floor(Math.random()*scenarios.length)];
      mood.value = sidx.m; stress.value = sidx.s; sleep.value = sidx.sl;
      updateLabels();

      const decision = decideRecommendation(sidx.m, sidx.s, sidx.sl);
      renderRecommendation(decision, { m: sidx.m, s: sidx.s, sl: sidx.sl });

      const newHistory = pushRecord(createRecord(sidx.m, sidx.s, sidx.sl));
      renderChart(newHistory);
    });

    // Reset -> set sliders to 0 and hide results & history unchanged
    reset.addEventListener('click', () => {
      mood.value = 0; stress.value = 0; sleep.value = 0; updateLabels();
      result.classList.remove('show'); result.innerHTML = ""; result.setAttribute('aria-hidden','true');
      safetyBanner.classList.remove('show'); consentBox.classList.remove('show');
    });

    // Consent interactions (same as before)
    consentCheck.addEventListener('change', () => { consentProceed.disabled = !consentCheck.checked; });
    consentProceed.addEventListener('click', () => {
      const decision = decideRecommendation(Number(mood.value), Number(stress.value), Number(sleep.value));
      if (decision.primary === 'immediate_recovery') {
        const optional = SUGGESTIONS.grounding_stress;
        if (!optional) return;
        const optionalHtml = `
          <div style="margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)">
            <strong style="display:block;margin-bottom:6px;color:var(--muted)">${optional.title} (optional, only if you feel safe)</strong>
            <div style="color:var(--muted);font-size:13px">${optional.short}</div>
            <ul style="margin:8px 0 0 18px;color:var(--success)">${optional.steps.map(s => `<li>${s}</li>`).join('')}</ul>
          </div>
        `;
        result.insertAdjacentHTML('beforeend', optionalHtml);
        consentBox.classList.remove('show');
      }
    });
    consentSkip.addEventListener('click', () => { consentBox.classList.remove('show'); });

    // Load initial chart from localStorage on page load
    (function init() {
      const hist = loadHistory();
      renderChart(hist);
      // keep sliders default to 0 and hide UI as requested
      mood.value = 0; stress.value = 0; sleep.value = 0; updateLabels();
      result.innerHTML = ""; result.classList.remove('show');
      safetyBanner.classList.remove('show'); consentBox.classList.remove('show');
    })();

    // keyboard accessibility
    [mood, stress, sleep].forEach(s => s.addEventListener('keydown', (e) => { if (e.key === 'Enter') go.click(); }));

  </script>
</body>
</html>
